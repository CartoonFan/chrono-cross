<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="build/vendor/jquery-1.11.3.min.js"></script>
        <script type="text/javascript" src="build/vendor/jdataview.js"></script>
        <script type="text/javascript" src="build/vendor/jparser.js"></script>
        <script type="text/javascript" src="build/vendor/three/three.js"></script>
        <script type="text/javascript" src="build/vendor/three/OrbitControls.js"></script>
        <script type="text/javascript" src="build/core.js"></script>
        <script type="text/javascript" src="build/cc.js"></script>
        <script type="text/javascript" src="build/vram.js"></script>
        <script type="text/javascript" src="src/three/CCBattlefield.js"></script>
        <style>
			html, body { 
			    margin: 0; 
			    padding: 0;
			    width: 100%;
			    height: 100%;
			}
			.buttons {
			    position: absolute;
			}
			label {
			    display: block;
			}
		</style>
    </head>
    <body>
        <div class="buttons">
            <select id="select" size="10">
                <option value="2417">2417.unknown_with_Kid_and_text.battlefield.drp</option>
                <option value="2418">2418.lizard_rock.battlefield.drp</option>
                <option value="2419">2419.cape_howl.battlefield.drp</option>
                <option value="2420">2420.cape_howl_at_dusk.battlefield.drp</option>
                <option value="2421">2421.fossil_valley.battlefield.drp</option>
                <option value="2422">2422.shadow_forest.battlefield.drp</option>
                <option value="2423">2423.shadow_forest_tree_stream.battlefield.drp</option>
                <option value="2424">2424.viper_manor_bluffs.battlefield.drp</option>
                <option value="2425">2425.viper_manor_bluffs_at_night.battlefield.drp</option>
                <option value="2426">2426.viper_manor.battlefield.drp</option>
                <option value="2427">2427.viper_manor_at_night.battlefield.drp</option>
                <option value="2428">2428.viper_manor_command_1.battlefield.drp</option>
                <option value="2429">2429.viper_manor_command_2.battlefield.drp</option>
                <option value="2430">2430.hydra_marshes_home.battlefield.drp</option>
                <option value="2431">2431.hydra_marshes_home_branches.battlefield.drp</option>
                <option value="2432">2432.hydra_marshes_home_hollow_tree.battlefield.drp</option>
                <option value="2433">2433.burnt-out_hermits_hideaway.battlefield.drp</option>
                <option value="2434">2434.ss_invincible_interior.battlefield.drp</option>
                <option value="2435">2435.ss_invincible_deck.battlefield.drp</option>
                <option value="2436">2436.water_dragon_isle_another.battlefield.drp</option>
                <option value="2437">2437.water_dragon_isle_home.battlefield.drp</option>
                <option value="2438">2438.mount_pyre.battlefield.drp</option>
                <option value="2439">2439.fort_dragonia.battlefield.drp</option>
                <option value="2440">2440.arni.battlefield.drp</option>
                <option value="2441">2441.earth_dragon_isle.battlefield.drp</option>
                <option value="2442">2442.earth_dragon_isle_sanctum.battlefield.drp</option>
                <option value="2443">2443.isle_of_the_damned.battlefield.drp</option>
                <option value="2444">2444.isle_of_the_damned_garai_battle.battlefield.drp</option>
                <option value="2445">2445.hydra_marshes_another.battlefield.drp</option>
                <option value="2446">2446.fate_island_clotho.battlefield.drp</option>
                <option value="2447">2447.darkness_beyond_time.battlefield.drp</option>
                <option value="2448">2448.marbule_cave.battlefield.drp</option>
                <option value="2449">2449.el_nido_triangle.battlefield.drp</option>
                <option value="2450">2450.luccas_orphanage.battlefield.drp</option>
                <option value="2451">2451.gaeas navel.battlefield.drp</option>
                <option value="2452">2452.gaeas_navel_sanctum.battlefield.drp</option>
                <option value="2453">2453.ss_zelbess_grand_slam_ring.battlefield.drp</option>
                <option value="2454">2454.shadow_forest_~ZOAH_BATTLE.battlefield.drp</option>
                <option value="2455">2455.viper_manor_library.battlefield.drp</option>
                <option value="2456">2456.guldove.battlefield.drp</option>
                <option value="2457">2457.marbule.battlefield.drp</option>
                <option value="2458">2458.mount_pyre_sanctum.battlefield.drp</option>
                <option value="2459">2459.fort_dragonia_blue_crystal_room.battlefield.drp</option>
                <option value="2460">2460.fort_dragonia_green_crystal_room_2.battlefield.drp</option>
                <option value="2461">2461.earth_dragon_isle_sanctum_2.battlefield.drp</option>
                <option value="2462">2462.terra_tower_exterior_warp.battlefield.drp</option>
                <option value="2463">2463.fort_dragonia_white_crystal_room.battlefield.drp</option>
                <option value="2464">2464.fort_dragonia_3.battlefield.drp</option>
                <option value="2465">2465.fort_dragonia_4.battlefield.drp</option>
                <option value="2466">2466.fort_dragonia_dragon_tear_chamber.battlefield.drp</option>
                <option value="2467">2467.terra_tower.battlefield.drp</option>
                <option value="2468">2468.terra_tower_exterior_warp_2.battlefield.drp</option>
                <option value="2469">2469.terra_tower_stairs.battlefield.drp</option>
                <option value="2470">2470.terra_tower_aquator.battlefield.drp</option>
                <option value="2471">2471.terra_tower_4.battlefield.drp</option>
                <option value="2472">2472.viper_manor_basement.battlefield.drp</option>
                <option value="2473">2473.viper_manor_sewer.battlefield.drp</option>
                <option value="2474">2474.saint_summon_clouds_glitchy.battlefield.drp</option>
                <option value="2475">2475.blue_whale_summon_water_glitchy.battlefield.drp</option>
                <option value="2476">2476.golem_summon_glitchy.battlefield.drp</option>
                <option value="2477">2477.luccas_orphanage_kitchen.battlefield.drp</option>
                <option value="2478">2478.luccas_orphanage_stairwell.battlefield.drp</option>
                <option value="2479">2479.luccas_orphanage_with_machine.battlefield.drp</option>
                <option value="2480">2480.mount_pyre_frozen_lava.battlefield.drp</option>
                <option value="2481">2481.mount_pyre_exterior.battlefield.drp</option>
                <option value="2482">2482.water_dragon_isle_interior.battlefield.drp</option>
                <option value="2483">2483.water_dragon_isle_sanctum.battlefield.drp</option>
                <option value="2484">2484.fate_island_lachesis.battlefield.drp</option>
                <option value="2485">2485.fate_island_atropos.battlefield.drp</option>
                <option value="2486">2486.fort_dragonia_bunyip_fight.battlefield.drp</option>
                <option value="2487">2487.luccas_orphanage_with_portraits.battlefield.drp</option>
                <option value="2488">2488.terra_tower_pyrotor.battlefield.drp</option>
                <option value="2489">2489.terra_tower_terrator.battlefield.drp</option>
                <option value="2490">2490.terra_tower_anemotor.battlefield.drp</option>
                <option value="2491">2491.terra_tower_dragon_god.battlefield.drp</option>
                <option value="2492">2492.chronopolis.battlefield.drp</option>
                <option value="2493">2493.chronopolis_2.battlefield.drp</option>
                <option value="2494">2494.chronopolis_stairway.battlefield.drp</option>
                <option value="2495">2495.chronopolis_frozen_flame.battlefield.drp</option>
                <option value="2496">2496.temporal_vortex.battlefield.drp</option>
                <option value="2497">2497.temporal_vortex_escheresque.battlefield.drp</option>
                <option value="2498">2498.viper_manor_ruins.battlefield.drp</option>
                <option value="2499">2499.dead_sea_highway.battlefield.drp</option>
                <option value="2500">2500.dead_sea_buildings.battlefield.drp</option>
                <option value="2501">2501.tower_of_geddon_mall.battlefield.drp</option>
                <option value="2502">2502.tower_of_geddon_theater.battlefield.drp</option>
                <option value="2503">2503.sky_dragon_isle_sanctum.battlefield.drp</option>
                <option value="2504">2504.unknown_glitchy.battlefield.drp</option>
                <option value="2505">2505.unknown_glitchy.battlefield.drp</option>
                <option value="2506">2506.unknown_glitchy.battlefield.drp</option>
                <option value="2507">2507.unknown_glitchy.battlefield.drp</option>
                <option value="2508">2508.unknown_glitchy.battlefield.drp</option>
                <option value="2509">2509.sky_dragon_isle_sanctum_2.battlefield.drp</option>
                <option value="2510">2510.ss_invincible_deck_with_ghosts.battlefield.drp</option>
                <option value="2511">2511.gaeas_navel_2.battlefield.drp</option>
                <option value="2512">2512.fort_dragonia_5.battlefield.drp</option>
                <option value="2513">2513.fort_dragonia_black_crystal_room.battlefield.drp</option>
                <option value="2514">2514.empty.battlefield.drp</option>
                <option value="2515">2515.empty.battlefield.drp</option>
                <option value="2516">2516.empty.battlefield.drp</option>
                <option value="2517">2517.terra_tower_glitchy.battlefield.drp</option>

            </select>
            <div id="obj" style="width: 200px; background: #fff;"></div>
        </div>
        </div>
        <script type="text/javascript">
            /* global THREE */
            /* global CC */
            /* global VRAM */
            
            $(document).ready(function () {
                
                $('#select').on('change', function() {
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', '/extract/2417-2517 Battlefields/' + $(this).val(), true);
                    xhr.responseType = 'arraybuffer';
                    
                    xhr.onload = function(e) {
                        if (this.status == 200) {
                            // get binary data as a response
                            var buffer = this.response;
                            battlefield = new CC.Battlefield( new CC.DrpReader(buffer) );
                            if(btl) {
                                scene.remove(btl);
                                $('#obj').html('');
                            }
                            scene.add( (btl=new THREE.CCBattlefield(battlefield, vram)) );
                            console.log('done');
                            
                            btl.children.forEach(function (obj) {
                                $('<label>')
                                    .append($('<input type="checkbox" checked="checked" />').click(function () {
                                        obj.visible = $(this).is(':checked');
                                    }))
                                    .append(obj.name)
                                    .appendTo('#obj');
                            });
                        }
                    };
                    
                    xhr.send();
                });
                
            });
            
            var vram = new VRAM(),
                // w = 640, h = 480,
                w = window.innerWidth, h = window.innerHeight,
                scene = new THREE.Scene(), 
                camera = new THREE.PerspectiveCamera( 75, w/h, 0.1, 1000 ),
                renderer = new THREE.WebGLRenderer(),
                controls = new THREE.OrbitControls( camera, renderer.domElement );
            var battlefield, btl;
            
            // renderer.sortObjects = false;
            renderer.setSize( w, h ); 
            renderer.setClearColor( 0x001018 );
            document.body.appendChild( renderer.domElement ); 
            
            // camera.position.x = 29.7284;
            // camera.position.y = 16.7577;
            // camera.position.z = 135.5286;
            //lizard
            camera.position.x = 269.06681881557654;
            camera.position.y = 24.46792632264594;
            camera.position.z = 45.6335152897888;
            
            var render = function () { 
                requestAnimationFrame( render ); 
                
                renderer.render(scene, camera); 
            }; 
            render();
            
            window.addEventListener('resize', function () {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                
                this.renderer.setSize( window.innerWidth, window.innerHeight ); 
            });
            
            
        </script>
    </body>
</html>